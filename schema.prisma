generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DB_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  name      String
  email     String   @unique
  password  String
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
  rol       String?  @default("CLIENTE") // "CLIENTE" o "ADMIN" No es obligatorio, pero por defecto toma cliente
  pedidos   Pedido[]
}

model MetodoPago {
  id_metodo   Int      @id @default(autoincrement())
  desc_metodo String
  pedido      Pedido[]
}

model Categoria {
  id_categoria   Int                  @id @default(autoincrement())
  nom_categoria  String
  desc_categoria String
  ar_ca          Categoria_Articulo[]
}

model Articulo {
  id_articulo  Int                  @id @default(autoincrement())
  nombre       String
  descripcion  String
  stock        Int
  precio       Float
  ar_ca        Categoria_Articulo[]
  linea_pedido Linea_Pedido[]
}

model Categoria_Articulo {
  id_categoria Int
  id_articulo  Int
  categoria    Categoria @relation(fields: [id_categoria], references: [id_categoria])
  articulo     Articulo  @relation(fields: [id_articulo], references: [id_articulo])

  @@id([id_categoria, id_articulo])
}

model Provincia {
  cod_provincia Int         @id @default(autoincrement())
  descripcion   String
  costo_envio   Float
  localidades   Localidad[]
}

model Localidad {
  id_localidad  Int       @id @default(autoincrement())
  nombre        String
  codigo_postal String
  cod_provincia Int
  provincia     Provincia @relation(fields: [cod_provincia], references: [cod_provincia])
  pedidos       Pedido[]
}

model Descuento {
  cod_descuento  Int    @id @default(autoincrement())
  desc_descuento String
}

model Linea_Pedido {
  id_articulo Int
  nro_pedido  Int
  cantidad    Int
  sub_total   Float
  pedido      Pedido   @relation(fields: [nro_pedido], references: [nro_pedido])
  articulo    Articulo @relation(fields: [id_articulo], references: [id_articulo])

  @@id([nro_pedido, id_articulo])
}

model Estado_Pedido {
  descripcion String
  fecha_desde DateTime @default(now())
  nro_pedido  Int
  pedido      Pedido   @relation(fields: [nro_pedido], references: [nro_pedido])

  @@id([nro_pedido, fecha_desde])
}

model Pedido {
  nro_pedido    Int             @id @default(autoincrement())
  fecha_pedido  DateTime        @default(now())
  precio_total  Float           @default(0)  // <- por defecto lo carga temporalmente en 0
  id_metodo     Int
  metodo_pago   MetodoPago      @relation(fields: [id_metodo], references: [id_metodo])
  nro_usuario   Int
  usuario       User            @relation(fields: [nro_usuario], references: [id])
  id_localidad  Int
  localidad     Localidad       @relation(fields: [id_localidad], references: [id_localidad])
  linea_pedido  Linea_Pedido[]
  estado_pedido Estado_Pedido[]
}

